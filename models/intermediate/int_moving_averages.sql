WITH stock_data AS (
    SELECT
        TICKER,
        DATE,
        CLOSE
    FROM {{ ref('stg_stock_prices') }}
)

SELECT
    TICKER,
    DATE,
    AVG(CLOSE) OVER (PARTITION BY TICKER ORDER BY DATE ROWS BETWEEN 29 PRECEDING AND CURRENT ROW) AS ma_30,
    AVG(CLOSE) OVER (PARTITION BY TICKER ORDER BY DATE ROWS BETWEEN 89 PRECEDING AND CURRENT ROW) AS ma_90
FROM stock_data
